
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Registering an Aerial Photo to an Orthophoto</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-06-29"><meta name="DC.source" content="ipexaerial.m"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit ipexaerial">Open ipexaerial.m in the Editor</a></div><div class="right"><a href="matlab:echodemo ipexaerial">Run in the Command Window</a></div></div><div class="content"><h1>Registering an Aerial Photo to an Orthophoto</h1><!--introduction--><p>Two images of the same scene can only be compared directly if they are in the same coordinate system. Image registration is the process of transforming one image into the coordinate system of another image.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Step 1: Read Images</a></li><li><a href="#3">Step 2: Load and Add Control Points</a></li><li><a href="#6">Step 3: Infer Geometric Transformation</a></li><li><a href="#7">Step 4: Transform Unregistered Image</a></li><li><a href="#8">Step 5: View Registered Image</a></li></ul></div><h2>Step 1: Read Images<a name="1"></a></h2><p>The image <tt>westconcordorthophoto.png</tt> is an orthophoto that has already been registered to the ground. The image <tt>westconcordaerial.png</tt> is unregistered as it was taken from an airplane and is distorted relative to the orthophoto.</p><pre class="codeinput">unregistered = imread(<span class="string">'westconcordaerial.png'</span>);
figure, imshow(unregistered)
text(size(unregistered,2),size(unregistered,1)+15, <span class="keyword">...</span>
    <span class="string">'Image courtesy of mPower3/Emerge'</span>, <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,7,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>);
</pre><img vspace="5" hspace="5" src="ipexaerial_01.png" alt=""> <pre class="codeinput">registeredOriginal = imread(<span class="string">'westconcordorthophoto.png'</span>);
figure, imshow(registeredOriginal)
text(size(registeredOriginal,2),size(registeredOriginal,1)+15, <span class="keyword">...</span>
    <span class="string">'Image courtesy of Massachusetts Executive Office of Environmental Affairs'</span>, <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,7,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>);
</pre><img vspace="5" hspace="5" src="ipexaerial_02.png" alt=""> <h2>Step 2: Load and Add Control Points<a name="3"></a></h2><p>Four pairs of control points have already been picked.  Load these points from a MAT-file.  If you want to proceed with these points, go to Step 3: Infer Geometric Transformation.</p><pre class="codeinput">load <span class="string">westconcordpoints</span>
</pre><p>Optionally, edit or add to the pre-picked points using the Control Point Selection Tool (<tt>cpselect</tt>).  <tt>cpselect</tt> helps you pick pairs of corresponding control points. Control points are landmarks that you can find in both images, like a road intersection, or a natural feature.  The unregistered image is an RGB image but <tt>cpselect</tt> only takes grayscale images, so you will pass it one plane of the RGB image.</p><pre>cpselect(unregistered(:,:,1),'westconcordorthophoto.png',...
         input_points,base_points)</pre><p>Save control points by choosing the <b>File</b> menu, then the <b>Save Points to Workspace</b> option. Save the points, overwriting variables <tt>input_points</tt> and <tt>base_points</tt>.</p><h2>Step 3: Infer Geometric Transformation<a name="6"></a></h2><p>Because we know that the unregistered image was taken from an airplane, and the topography is relatively flat, it is likely that most of the distortion is projective. <tt>cp2tform</tt> will find the parameters of the projective distortion that best fits the stray input_points and base_points you picked.</p><pre class="codeinput">t_concord = cp2tform(input_points,base_points,<span class="string">'projective'</span>);
</pre><h2>Step 4: Transform Unregistered Image<a name="7"></a></h2><p>Even though the points were picked on one plane of the unregistered image, you can transform the entire RGB image. <tt>imtransform</tt> will apply the same transformation to each plane. Note that the choice of 'XData' and 'YData' values ensures the registered image will be aligned with the orthophoto.</p><pre class="codeinput">info = imfinfo(<span class="string">'westconcordorthophoto.png'</span>);
registered = imtransform(unregistered,t_concord,<span class="keyword">...</span>
                         <span class="string">'XData'</span>,[1 info.Width], <span class="string">'YData'</span>,[1 info.Height]);
</pre><h2>Step 5: View Registered Image<a name="8"></a></h2><pre class="codeinput">figure, imshow(registered)
</pre><img vspace="5" hspace="5" src="ipexaerial_03.png" alt=""> <p>Compare this visually to the orthophoto and to the unregistered image. Try going back to Step 2: Choose Control Points and using more than four pairs of points. Are the results better? What if the points are clumped together?</p><p>If you want to experiment with larger images, follow the steps above to register <tt>concordaerial.png</tt> to <tt>concordorthophoto.png</tt>.</p><p class="footer">Copyright 2004-2005 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% Registering an Aerial Photo to an Orthophoto
% Two images of the same scene can only be compared directly if they are in
% the same coordinate system. Image registration is the process of
% transforming one image into the coordinate system of another image.

% Copyright 2004-2005 The MathWorks, Inc. 

%% Step 1: Read Images
% The image |westconcordorthophoto.png| is an orthophoto that has already
% been registered to the ground. The image |westconcordaerial.png| is
% unregistered as it was taken from an airplane and is distorted relative
% to the orthophoto.

unregistered = imread('westconcordaerial.png');
figure, imshow(unregistered)
text(size(unregistered,2),size(unregistered,1)+15, ...
    'Image courtesy of mPower3/Emerge', ...
    'FontSize',7,'HorizontalAlignment','right');

%%
registeredOriginal = imread('westconcordorthophoto.png');
figure, imshow(registeredOriginal)
text(size(registeredOriginal,2),size(registeredOriginal,1)+15, ...
    'Image courtesy of Massachusetts Executive Office of Environmental Affairs', ...
    'FontSize',7,'HorizontalAlignment','right');
 
%% Step 2: Load and Add Control Points
% Four pairs of control points have already been picked.  Load these points
% from a MAT-file.  If you want to proceed with these points, go to Step 3:
% Infer Geometric Transformation.

load westconcordpoints

%%
% Optionally, edit or add to the pre-picked points using the Control Point
% Selection Tool (|cpselect|).  |cpselect| helps you pick pairs of
% corresponding control points. Control points are landmarks that you can find
% in both images, like a road intersection, or a natural feature.  The
% unregistered image is an RGB image but |cpselect| only takes grayscale
% images, so you will pass it one plane of the RGB image.
% 
%  cpselect(unregistered(:,:,1),'westconcordorthophoto.png',... 
%           input_points,base_points) 

%%
% Save control points by choosing the *File* menu, then the *Save Points to
% Workspace* option. Save the points, overwriting variables |input_points| and
% |base_points|.

%% Step 3: Infer Geometric Transformation
% Because we know that the unregistered image was taken from an airplane,
% and the topography is relatively flat, it is likely that most of the
% distortion is projective. |cp2tform| will find the parameters of the
% projective distortion that best fits the stray input_points and
% base_points you picked. 

t_concord = cp2tform(input_points,base_points,'projective');

%% Step 4: Transform Unregistered Image
% Even though the points were picked on one plane of the unregistered
% image, you can transform the entire RGB image. |imtransform| will apply the
% same transformation to each plane. Note that the choice of 'XData' and
% 'YData' values ensures the registered image will be aligned with the
% orthophoto.

info = imfinfo('westconcordorthophoto.png');
registered = imtransform(unregistered,t_concord,...
                         'XData',[1 info.Width], 'YData',[1 info.Height]);
                      
%% Step 5: View Registered Image

figure, imshow(registered)

%%
% Compare this visually to the orthophoto and to the unregistered image.
% Try going back to Step 2: Choose Control Points and using more than four
% pairs of points. Are the results better? What if the points are clumped
% together?

%%
% If you want to experiment with larger images, follow the steps above to
% register |concordaerial.png| to |concordorthophoto.png|.


displayEndOfDemoMessage(mfilename)
##### SOURCE END #####
--></body></html>