
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>マルチスペクトル イメージ内の植生を検出</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="ipexndvi.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit ipexndvi">エディターで ipexndvi.m を開く</a></div><div class="right"><a href="matlab:echodemo ipexndvi">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>マルチスペクトル イメージ内の植生を検出</h1><!--introduction--><p>異なるスペクトル バンドに沿った表面物質の反射率の変化は、遠隔測定されたマルチスペクトルイメージ内の特徴を理解するための基本的な機能を与えます。</p><p>この例は、有意な植生を含む領域を識別するのに使われる LANDSAT イメージの可視赤色光と、近赤外線 (NIR) バンド間にどのような違いがあるかを示します。Space Imaging, LLC の利用可能なサービスである、フランス、パリの一部を網羅する LANDSAT Thematic Mapper イメージを使用します。7 つのスペクトル バンドは Erdas LAN 形式の 1 つのファイルに保存されます。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">手順 1:BIL イメージ ファイルからの CIR 帯域のインポート</a></li><li><a href="#3">手順 2:無相関ストレッチによる CIR 合成イメージの強化</a></li><li><a href="#5">手順 3:NIR-Red スペクトル散布図の構築</a></li><li><a href="#9">手順 4:MATLAB&reg; 配列演算による植生インデックスの計算</a></li><li><a href="#13">手順 5:植生の配置 -- NDVI イメージのしきい値処理</a></li><li><a href="#16">手順 6:スペクトル量と空間量のリンク</a></li></ul></div><h2>手順 1:BIL イメージ ファイルからの CIR 帯域のインポート<a name="1"></a></h2><p>LAN ファイル <tt>paris.lan</tt> には、7 帯域の 512&times;512 の Landsat イメージが含まれています。128 バイトのヘッダーにはピクセル値が続きます。これは、帯域番号の昇順のライン挟み込みバンド並び (BIL) です。リトルエンディアンの順番で符号なし 8 ビット整数として保存されます。</p><p>最初の手順では、MATLAB&reg; 関数 <tt>multibandread</tt> を使用して LAN ファイルから帯域 4、3、および 2 を読み込みます。</p><p>Thematic Mapper 4、3、および 2 帯域は、 電磁スペクトルの近赤外線(NIR)、可視赤色光、および可視緑色光の部分を網羅します。それぞれが RGB イメージである赤、緑、および青の平面にマッピングされる場合、その結果は標準のカラー赤外 (CIR) 合成イメージになります。<tt>multibandread</tt> への最後の入力引数では、読み取る帯域と、その順序を指定します。そのため、1 ステップで合成イメージを作成できます。</p><pre class="codeinput">CIR = multibandread(<span class="string">'paris.lan'</span>, [512, 512, 7], <span class="string">'uint8=&gt;uint8'</span>,<span class="keyword">...</span>
                    128, <span class="string">'bil'</span>, <span class="string">'ieee-le'</span>, {<span class="string">'Band'</span>,<span class="string">'Direct'</span>,[4 3 2]});
</pre><p>変数 <tt>CIR</tt> はクラス <tt>uint8</tt> の 512&times;512&times;3 の配列です。これは RGB イメージですが、疑似色を持っています。イメージを表示する場合、赤は NIR 帯域、緑は可視赤色光帯域、青は可視緑色光帯域をそれぞれ示します。CIR イメージでは、水は非常に暗い特徴を持ち (セーヌ川)、緑の植生は赤く見えます (公園および街路樹)。全体的に見て、コントラストは低く、色は薄くなっています。</p><pre class="codeinput">figure
imshow(CIR)
title(<span class="string">'CIR Composite (Un-enhanced)'</span>)
text(size(CIR,2), size(CIR,1) + 15,<span class="keyword">...</span>
  <span class="string">'Image courtesy of Space Imaging, LLC'</span>,<span class="keyword">...</span>
  <span class="string">'FontSize'</span>, 7, <span class="string">'HorizontalAlignment'</span>, <span class="string">'right'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_01.png" alt=""> <h2>手順 2: 無相関ストレッチによる CIR 合成イメージの強化<a name="3"></a></h2><p>これは、CIR 合成イメージの解析の前に、より効果的なイメージ表示を得るための強化に役立ちます。  元の合成イメージでの淡い色の差異のため、無相関ストレッチが適しています。  関数 <tt>decorrstretch</tt> を使用できます。これは、相関があるチャンネルの全域にわたる色の分離を強化でき、また、オプションの線形コントラストのストレッチを指定して、各帯域の 1% の最も明るいピクセルと最も暗いピクセルを飽和させることもできます。</p><pre class="codeinput">decorrCIR = decorrstretch(CIR, <span class="string">'Tol'</span>, 0.01);
figure
imshow(decorrCIR)
title(<span class="string">'CIR Composite with Decorrelation Stretch'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_02.png" alt=""> <p>表面特徴はより明確になり、イメージはよりカラフルになっています。これは、表示全域のスペクトル差異が誇張されており、コントラストが増加しているためです。</p><p>イメージの外観の多くは、元気でクロロフィル豊富な植生が近赤外線で高い反射率を持つという事実によります。NIR 帯域は合成イメージの赤いチャンネルにマッピングされるので、植生密度が高い領域はディスプレイに赤く表示されます。注目すべき例は、セーヌ川の湾曲部内のパリ中心部の西側に位置する大きな公園 (ブーローニュの森) である左端の明るい赤の領域です。</p><p>NIR と赤い帯域間の差異を解析することにより、このコントラストを、植生地域とその他の外見 (路面、露出土壌、建物、水など) の間のスペクトル量で定量化できます。</p><h2>手順 3:NIR-Red スペクトル散布図の構築<a name="5"></a></h2><p>NIR 帯域(赤で表示) と可視赤色光帯域 (緑色で表示) を比較する場合、散布図から始めます。これは、これらの帯域を元の CIR 合成イメージから抽出し、独立した変数にするのに便利です(無相関ストレッチが行われたイメージは視覚的な表示には適していますが、スペクトル解析には適していないため、元の帯域に戻ります)。これはまた、散布図だけでなく、以下の NDVI 計算でも同じ変数を使用できるので、クラス <tt>uint8</tt> をクラス <tt>single</tt> に変換するときにも役立ちます。</p><pre class="codeinput">NIR = im2single(CIR(:,:,1));
red = im2single(CIR(:,:,2));
</pre><p>差異を見比べるため、2 つの帯域を一緒にグレースケール イメージとして表示します。</p><pre class="codeinput">figure
imshow(red)
title(<span class="string">'Visible Red Band'</span>)
figure
imshow(NIR)
title(<span class="string">'Near Infrared Band'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_03.png" alt=""> <img vspace="5" hspace="5" src="../ipexndvi_04.png" alt=""> <p>MATLABでの <tt>plot</tt> コマンドを呼び出すだけで、赤い帯域の値により決定されるその X 座標と、NIR 帯域の値による Y 座標と共に、1 ピクセルに 1 つの点 (この場合は青い十字) を表示する散布図を作成できます。</p><pre class="codeinput">figure
plot(red, NIR, <span class="string">'+b'</span>)
set(gca, <span class="string">'XLim'</span>, [0 1], <span class="string">'XTick'</span>, 0:0.2:1,<span class="keyword">...</span>
         <span class="string">'YLim'</span>, [0 1], <span class="string">'YTick'</span>, 0:0.2:1);
axis <span class="string">square</span>
xlabel(<span class="string">'red level'</span>)
ylabel(<span class="string">'NIR level'</span>)
title(<span class="string">'NIR vs. Red Scatter Plot'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_05.png" alt=""> <p>パリの景色の散布図の外観は、青葉がある温暖な市街地を特徴としています。NIR と赤の値がほぼ等しい対角線の近くに一連のピクセルがあります。この &quot;グレーの境界&quot; には、路面や多数の屋根などの特徴が含まれています。上側と左側は、多くの場合に NIR 値が赤の値をかなり上回る別の一連のピクセルです。このゾーンは、基本的にすべての緑の植生を取り囲みます。</p><h2>手順 4:MATLAB&reg; 配列演算による植生インデックスの計算<a name="9"></a></h2><p>散布図から、NIR レベル対赤のレベルの比率を読み取ることが、密集した植生を含むピクセルを位置付ける方法の 1 つであることに気付きます。ただし、その結果は、両方の帯域の小さな値を持つ暗いピクセルについてはノイズを含みます。また、NIR と赤の間の差異は、クロロフィル密度が高いほど大きくなることに注意してください。正規化植生指標 (NDVI) は、この 2 番目の観察によって変動します。これにより (NIR - Red) 差異を読み取って正規化し、雲や丘など一様ではない照度の効果を釣り合わせるのに役立てます。つまり、ピクセルごとに、赤い帯域の値を NIR 帯域の値から減算し、その合計で除算します。</p><pre class="codeinput">ndvi = (NIR - red) ./ (NIR + red);
</pre><p>MATLAB の配列算術演算子により、1 つの簡単なコマンドだけで、NDVI イメージ全体を計算することが可能になることに注目してください。変数 <tt>red</tt> および <tt>NIR</tt> にはクラス <tt>single</tt> があることを思い出してください。この選択により使用されるメモリ量はクラス <tt>double</tt> より少ないですが、整数クラスとは異なり、結果の比率で値の滑らかなグラデーションを推測することも可能です。</p><p>変数 <tt>ndvi</tt> は、理論上の最大範囲が [-1 1] であるクラス <tt>single</tt> の 2 次元配列です。<tt>ndvi</tt> をグレースケール イメージとして表示すると、これらの理論上の制限値を指定できます。</p><pre class="codeinput">figure
imshow(ndvi,<span class="string">'DisplayRange'</span>,[-1 1])
title(<span class="string">'Normalized Difference Vegetation Index'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_06.png" alt=""> <p>セーヌ川は、NDVI イメージでは非常に暗く表示されます。イメージの左端付近の大きな明るい領域は、前述の公園 (ブーローニュの森) です。</p><h2>手順 5:植生の配置 -- NDVI イメージのしきい値処理<a name="13"></a></h2><p>多くの植生を含んでいる可能性が最も高いピクセルを特定するには、単純なしきい値を NDVI イメージに適用します。</p><pre class="codeinput">threshold = 0.4;
q = (ndvi &gt; threshold);
</pre><p>したがって、選択したピクセルの割合は以下のようになります。</p><pre class="codeinput">100 * numel(NIR(q(:))) / numel(NIR)
</pre><pre class="codeoutput">
ans =

    5.2204

</pre><p>つまり、約 5% になります。</p><p>公園や植生の他の小さな領域は、論理 (バイナリ) イメージ <tt>q</tt> を表示したときに、既定で白く表示されます。</p><pre class="codeinput">figure
imshow(q)
title(<span class="string">'NDVI with Threshold Applied'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_07.png" alt=""> <h2>手順 6:スペクトル量と空間情報のリンク<a name="16"></a></h2><p>スペクトル量と空間情報をリンクするには、しきい値より上のピクセルを NIR-Red の散布図に配置します。これにより、しきい値より上のピクセルを持つ散布図が対照的な色 (緑) で再描画され、しきい値 NDVI イメージが同じ青緑色のスキームで再表示されます。予想どおり、しきい値より上の NDVI 値を持つピクセルは、その他のピクセルの左上に現れ、CIR 合成イメージ表示のより赤いピクセルと一致します。</p><pre class="codeinput"><span class="comment">% Create a figure with a 1-by-2 aspect ratio</span>
h = figure;
p = get(h,<span class="string">'Position'</span>);
set(h,<span class="string">'Position'</span>,[p(1,1:3),p(3)/2])
subplot(1,2,1)
<span class="comment">% Create the scatter plot</span>
plot(red, NIR, <span class="string">'+b'</span>)
hold <span class="string">on</span>
plot(red(q(:)), NIR(q(:)), <span class="string">'g+'</span>)
set(gca, <span class="string">'XLim'</span>, [0 1], <span class="string">'YLim'</span>, [0 1])
axis <span class="string">square</span>
xlabel(<span class="string">'red level'</span>)
ylabel(<span class="string">'NIR level'</span>)
title(<span class="string">'NIR vs. Red Scatter Plot'</span>)
<span class="comment">% Display the thresholded NDVI</span>
subplot(1,2,2)
imshow(q)
set(h,<span class="string">'Colormap'</span>,[0 0 1; 0 1 0])
title(<span class="string">'NDVI with Threshold Applied'</span>)
</pre><img vspace="5" hspace="5" src="../ipexndvi_08.png" alt=""> <p><tt>decorrstretch</tt>、<tt>im2single</tt>、<tt>ipexlanstretch</tt>、<tt>multibandread</tt> も参照してください。</p><p class="footer">Copyright 2004-2008 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Finding Vegetation in a Multispectral Image % Variations in the reflectivity of surface materials across different % spectral bands provide a fundamental mechanism for understanding features % in remotely-sensed multispectral imagery. % % This example shows how differences between the visible red and % near-infrared (NIR) bands of a LANDSAT image can be used to identify % areas containing significant vegetation.  It uses a LANDSAT Thematic % Mapper image covering part of Paris, France, made available courtesy of % Space Imaging, LLC.  Seven spectral bands are stored in one file in the % Erdas LAN format.  % Copyright 2004-2008 The MathWorks, Inc.    %% Step 1: Import CIR Bands from a BIL Image File % The LAN file, |paris.lan|, contains a 7-band 512-by-512 Landsat image. A % 128-byte header is followed by the pixel values, which are band % interleaved by line (BIL) in order of increasing band number.  They are % stored as unsigned 8-bit integers, in little-endian byte order. % % The first step is to read bands 4, 3, and 2 from the LAN file using the % MATLAB(R) function |multibandread|. % % Thematic Mapper 4, 3, and 2 bands cover the near infrared (NIR), the % visible red, and the visible green parts of the electromagnetic spectrum. % When they are mapped to the red, green, and blue planes, respectively, of % an RGB image the result is a standard color-infrared (CIR) composite. % The final input argument to |multibandread| specifies which bands to % read, and in which order, so that you can construct a composite in a % single step. CIR = multibandread('paris.lan', [512, 512, 7], 'uint8=>uint8',...                     128, 'bil', 'ieee-le', {'Band','Direct',[4 3 2]});  %% % Variable |CIR| is a 512-by-512-by-3 array of class |uint8|.  It is an RGB % image, but with false colors.  When the image is displayed, red signifies % the NIR band, green signifies the visible red band, and blue signifies % the visible green band. In the CIR image, water features are very dark % (the Seine River) and green vegetation appears red (parks and shade % trees).  Overall, the contrast is low and the colors are subtle. figure imshow(CIR) title('CIR Composite (Un-enhanced)') text(size(CIR,2), size(CIR,1) + 15,...   'Image courtesy of Space Imaging, LLC',...   'FontSize', 7, 'HorizontalAlignment', 'right')  %% Step 2: Enhance the CIR Composite with a Decorrelation Stretch % It's helpful, before analyzing the CIR composite, to enhance it for more % effective visual display.  Because of the subtle color differences in the % original composite, a decorrelation stretch is suitable.  You can use the % function |decorrstretch|, which enhances color separation across % correlated channels, and also specify an optional linear contrast stretch % to saturate the brightest and darkest one percent of the pixels in each % band. decorrCIR = decorrstretch(CIR, 'Tol', 0.01); figure imshow(decorrCIR) title('CIR Composite with Decorrelation Stretch')  %% % The surface features have become much more obvious and the image is more % colorful. This is because the spectral differences across the scene have % been exaggerated and the contrast has been increased. % % Much of the image appearance is due to the fact that healthy, % chlorophyll-rich vegetation has a high reflectance in the near infrared. % Because the NIR band is mapped to the red channel in our composite, any % area with  a high vegetation density appears red in the display. A % noticeable example is the area of bright red on the left edge, a large % park (the Bois de Boulogne) located west of central Paris within a bend % of the Seine River. % % By analyzing differences between the NIR and red bands, you can quantify % this contrast in spectral content between vegetated areas and other % surfaces such as pavement, bare soil, buildings, or water.  %% Step 3: Construct an NIR-Red Spectral Scatter Plot % A scatter plot is a natural place to start when comparing the NIR band % (displayed as red) with the visible red band (displayed as green). It's % convenient to extract these bands from the original CIR composite into % individual variables.  (We return to the original bands, because the % decorrelation-stretched image is appropriate for visual display but not % for spectral analysis.)  It's also helpful to convert from class |uint8| % to class |single| so that the same variables can be used in the NDVI % computation below, as well as in the scatter plot. NIR = im2single(CIR(:,:,1)); red = im2single(CIR(:,:,2));  %% % Viewing the two bands together as grayscale images, you can see how % different they look.  figure imshow(red) title('Visible Red Band') figure imshow(NIR) title('Near Infrared Band')  %% % With one simple call to the |plot| command in MATLAB, you can create a % scatter plot displaying one point per pixel (as a blue cross, in this % case), with its X-coordinate determined by its value in the red band and % its Y-coordinate by the value its value in the NIR band. figure plot(red, NIR, '+b') set(gca, 'XLim', [0 1], 'XTick', 0:0.2:1,...          'YLim', [0 1], 'YTick', 0:0.2:1); axis square xlabel('red level') ylabel('NIR level') title('NIR vs. Red Scatter Plot')  %% % The appearance of the scatter plot of the Paris scene is characteristic % of a temperate urban area with trees in summer foliage. There's a set of % pixels near the diagonal for which the NIR and red values are nearly % equal.  This "gray edge" includes features such as road surfaces and many % rooftops.  Above and to the left is another set of pixels for which the % NIR value is often well above the red value.  This zone encompasses % essentially all of the green vegetation.  %% Step 4: Compute Vegetation Index via MATLAB(R) Array Arithmetic % Observe from the scatter plot that taking the ratio of the NIR level to % red level would be one way to locate pixels containing dense vegetation. % However, the result would be noisy for dark pixels with small values in % both bands. Also notice that the difference between the NIR and red % should be larger for greater chlorophyll density. The Normalized % Difference Vegetation Index (NDVI) is motivated by this second % observation.  It takes the (NIR - red) difference and normalizes it to % help balance out the effects of uneven illumination such as the shadows % of clouds or hills.  In other words, on a pixel-by-pixel basis subtract % the value of the red band from the value of the NIR band and divide by % their sum. ndvi = (NIR - red) ./ (NIR + red);  %% % Notice how the array-arithmetic operators in MATLAB make it possible to % compute an entire NDVI image in one simple command.  Recall that % variables |red| and |NIR| have class |single|.  This choice uses less % storage than class |double| but unlike an integer class also allows the % resulting ratio to assume a smooth gradation of values.  %% % Variable |ndvi| is a 2-D array of class |single| with a theoretical % maximum range of [-1 1].  You can specify these theoretical limits when % displaying |ndvi| as a grayscale image. figure imshow(ndvi,'DisplayRange',[-1 1]) title('Normalized Difference Vegetation Index')  %% % The Seine River appears very dark in the NDVI image.  The large light % area near the left edge of the image is the park (Bois de Boulogne) noted % earlier.  %% Step 5: Locate Vegetation REPLACE_WITH_DASH_DASH Threshold the NDVI Image % In order to identify pixels most likely to contain significant % vegetation, you can apply a simple threshold to the NDVI image. threshold = 0.4; q = (ndvi > threshold);  %% % The percentage of pixels selected is thus 100 * numel(NIR(q(:))) / numel(NIR)  %% % or about 5 percent. % % The park and other smaller areas of vegetation appear white by % default when displaying the logical (binary) image |q|. figure imshow(q) title('NDVI with Threshold Applied')  %% Step 6: Link Spectral and Spatial Content % To link the spectral and spatial content, you can locate above-threshold % pixels on the NIR-red scatter plot, re-drawing the scatter plot with the % above-threshold pixels in a contrasting color (green) and then % re-displaying the threshold NDVI image using the same blue-green color % scheme.  As expected, the pixels having an NDVI value above the threshold % appear to the upper left of the rest and correspond to the redder pixels % in the CIR composite displays.  % Create a figure with a 1-by-2 aspect ratio h = figure; p = get(h,'Position'); set(h,'Position',[p(1,1:3),p(3)/2]) subplot(1,2,1) % Create the scatter plot plot(red, NIR, '+b') hold on plot(red(q(:)), NIR(q(:)), 'g+') set(gca, 'XLim', [0 1], 'YLim', [0 1]) axis square xlabel('red level') ylabel('NIR level') title('NIR vs. Red Scatter Plot') % Display the thresholded NDVI subplot(1,2,2) imshow(q) set(h,'Colormap',[0 0 1; 0 1 0]) title('NDVI with Threshold Applied')  %% % See also |decorrstretch|, |im2single|, |ipexlanstretch|, |multibandread|.   displayEndOfDemoMessage(mfilename)  ##### SOURCE END ##### --></body></html>