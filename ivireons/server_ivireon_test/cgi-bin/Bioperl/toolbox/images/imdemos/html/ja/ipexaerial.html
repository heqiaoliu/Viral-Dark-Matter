
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>航空写真から正射写真へレジスタリング</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="../http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-05-27"><meta name="DC.source" content="ipexaerial.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit ipexaerial">エディターで ipexaerial.m を開く</a></div><div class="right"><a href="matlab:echodemo ipexaerial">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>航空写真から正射写真へレジスタリング</h1><!--introduction--><p>2 つの同じ風景のイメージは、同じ座標系にある場合にのみ直接比較できます。 イメージのレジストレーションは、1 つのイメージを別のイメージの座標系に変換するプロセスです。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">手順 1:  イメージの読み込み</a></li><li><a href="#3">手順 2:  コントロール ポイントの読み込みと追加</a></li><li><a href="#6">手順 3:  幾何学的変換の推測</a></li><li><a href="#7">手順 4:  レジストレーションされていないイメージの変換</a></li><li><a href="#8">手順 5:  レジストレーションされたイメージの表示</a></li></ul></div><h2>手順 1:  イメージの読み込み<a name="1"></a></h2><p>イメージ <tt>westconcordorthophoto.png</tt> は地上にレジストレーションされた正射写真です。 イメージ <tt>westconcordaerial.png</tt> は、飛行機から撮影され正射写真と比較して変形されているためレジストレーションされません。</p><pre class="codeinput">unregistered = imread(<span class="string">'westconcordaerial.png'</span>);
figure, imshow(unregistered)
text(size(unregistered,2),size(unregistered,1)+15, <span class="keyword">...</span>
    <span class="string">'Image courtesy of mPower3/Emerge'</span>, <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,7,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>);
</pre><img vspace="5" hspace="5" src="../ipexaerial_01.png" alt=""> <pre class="codeinput">registeredOriginal = imread(<span class="string">'westconcordorthophoto.png'</span>);
figure, imshow(registeredOriginal)
text(size(registeredOriginal,2),size(registeredOriginal,1)+15, <span class="keyword">...</span>
    <span class="string">'Image courtesy of Massachusetts Executive Office of Environmental Affairs'</span>, <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,7,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>);
</pre><img vspace="5" hspace="5" src="../ipexaerial_02.png" alt=""> <h2>手順 2:  コントロール ポイントの読み込みと追加<a name="3"></a></h2><p>4 組のコントロール ポイントが選択されています。  MAT ファイルからこれらのポイントを読み込みます。  これらのポイントの処理を続行するには、手順 3  「幾何学的変換の推測」に進みます。</p><pre class="codeinput">load <span class="string">westconcordpoints</span>
</pre><p>オプションで、Control Point Selection Tool (<tt>cpselect</tt>) を使用してあらかじめ選択したポイントを編集または追加します。<tt>cpselect</tt> を使用すると、対応するコントロール ポイントのペアを選択できます。 コントロール ポイントは、道路の立体交差や地勢など 2 つのイメージで識別できるランドマークです。  レジストレーションされていないイメージは RGB イメージですが、<tt>cpselect</tt> はグレースケールイメージに対してのみ利用できるので、この関数に RGB イメージの 1 つの平面を渡します。</p><pre>cpselect(unregistered(:,:,1),'westconcordorthophoto.png',...
         input_points,base_points)</pre><p><b></b>[ファイル] メニュー、<b></b>[ポイントをワークスペースへ保存] オプションを選択して、コントロール ポイントを保存します。 ポイントを保存して変数 <tt>input_points</tt> と <tt>base_points</tt> を上書きします。</p><h2>手順 3:  幾何学的変換の推測<a name="6"></a></h2><p>レジストレーションされていないイメージは飛行機から撮影されており、地形が比較的平坦な歪みの大部分は射影になる可能性があります。<tt>cp2tform</tt> は、選択した input_points と base_points に最適な射影歪みのパラメーターを見つけます。</p><pre class="codeinput">t_concord = cp2tform(input_points,base_points,<span class="string">'projective'</span>);
</pre><h2>手順 4:  レジストレーションされていないイメージの変換<a name="7"></a></h2><p>レジストレーションされていないイメージの 1 つの平面でポイントを選択した場合でも、RGB イメージ全体を変換できます。<tt>imtransform</tt> は、各平面に同じ変換を適用します。 'XData' 値と 'YData' 値を選択すると、レジストレーションされたイメージは正射写真と一致します。</p><pre class="codeinput">info = imfinfo(<span class="string">'westconcordorthophoto.png'</span>);
registered = imtransform(unregistered,t_concord,<span class="keyword">...</span>
                         <span class="string">'XData'</span>,[1 info.Width], <span class="string">'YData'</span>,[1 info.Height]);
</pre><h2>手順 5: レジストレーションされたイメージの表示<a name="8"></a></h2><pre class="codeinput">figure, imshow(registered)
</pre><img vspace="5" hspace="5" src="../ipexaerial_03.png" alt=""> <p>このイメージを正射写真およびレジストレーションされていないイメージと視覚的に比較してみます。まずは手順 2 に戻ってみます。コントロール ポイントを選択し、4 組以上のポイントを使用します。結果は改善されましたか。ポイントを凝集するとどうなるでしょう。</p><p>より大きなイメージで実験する場合は、上記の手順を実行して <tt>concordaerial.png</tt> を <tt>concordorthophoto.png</tt> にレジストレーションします。</p><p class="footer">Copyright 2004-2005 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.11</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Registering an Aerial Photo to an Orthophoto % Two images of the same scene can only be compared directly if they are in % the same coordinate system. Image registration is the process of % transforming one image into the coordinate system of another image.  % Copyright 2004-2005 The MathWorks, Inc.   %% Step 1: Read Images % The image |westconcordorthophoto.png| is an orthophoto that has already % been registered to the ground. The image |westconcordaerial.png| is % unregistered as it was taken from an airplane and is distorted relative % to the orthophoto.  unregistered = imread('westconcordaerial.png'); figure, imshow(unregistered) text(size(unregistered,2),size(unregistered,1)+15, ...     'Image courtesy of mPower3/Emerge', ...     'FontSize',7,'HorizontalAlignment','right');  %% registeredOriginal = imread('westconcordorthophoto.png'); figure, imshow(registeredOriginal) text(size(registeredOriginal,2),size(registeredOriginal,1)+15, ...     'Image courtesy of Massachusetts Executive Office of Environmental Affairs', ...     'FontSize',7,'HorizontalAlignment','right');   %% Step 2: Load and Add Control Points % Four pairs of control points have already been picked.  Load these points % from a MAT-file.  If you want to proceed with these points, go to Step 3: % Infer Geometric Transformation.  load westconcordpoints  %% % Optionally, edit or add to the pre-picked points using the Control Point % Selection Tool (|cpselect|).  |cpselect| helps you pick pairs of % corresponding control points. Control points are landmarks that you can find % in both images, like a road intersection, or a natural feature.  The % unregistered image is an RGB image but |cpselect| only takes grayscale % images, so you will pass it one plane of the RGB image. %  %  cpselect(unregistered(:,:,1),'westconcordorthophoto.png',...  %           input_points,base_points)   %% % Save control points by choosing the *File* menu, then the *Save Points to % Workspace* option. Save the points, overwriting variables |input_points| and % |base_points|.  %% Step 3: Infer Geometric Transformation % Because we know that the unregistered image was taken from an airplane, % and the topography is relatively flat, it is likely that most of the % distortion is projective. |cp2tform| will find the parameters of the % projective distortion that best fits the stray input_points and % base_points you picked.   t_concord = cp2tform(input_points,base_points,'projective');  %% Step 4: Transform Unregistered Image % Even though the points were picked on one plane of the unregistered % image, you can transform the entire RGB image. |imtransform| will apply the % same transformation to each plane. Note that the choice of 'XData' and % 'YData' values ensures the registered image will be aligned with the % orthophoto.  info = imfinfo('westconcordorthophoto.png'); registered = imtransform(unregistered,t_concord,...                          'XData',[1 info.Width], 'YData',[1 info.Height]);                        %% Step 5: View Registered Image  figure, imshow(registered)  %% % Compare this visually to the orthophoto and to the unregistered image. % Try going back to Step 2: Choose Control Points and using more than four % pairs of points. Are the results better? What if the points are clumped % together?  %% % If you want to experiment with larger images, follow the steps above to % register |concordaerial.png| to |concordorthophoto.png|.   displayEndOfDemoMessage(mfilename) ##### SOURCE END ##### --></body></html>